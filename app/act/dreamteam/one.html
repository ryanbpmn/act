<!DOCTYPE html>
<html>
<head lang="en">
    @import '../../template/head.html'
    <title>我的最佳阵容</title>
    <style type="text/css">
        @import './index@@MINEXT.css';
    </style>
    <link rel="stylesheet" href="./images/gj.css"/>
    <link rel="stylesheet" href="./images/qy.css"/>
    <link rel="stylesheet" href="./images/guoqi.css"/>
    <script type="text/javascript" src="../../common/util.js"></script>
    <script src="./js/stateman.js"></script>
    <script src="underscore-min.js"></script>
</head>
<body>
<div id="app" style="width:100%;height:100%">

</div>
        <!-- 首页-->
        <script type="text/template" id="index">
            <div class="index">
                <a href="#/select"  class="dot" style="position:absolute;top:7rem;width:.80rem;height:.87rem;transform: translate(-50%,-50%);left: 50%;">
                    <img src="./img/qiu.png" class="xu"/>
                </a>
                <img src="./img/db.png" class="pai" />
            </div>
        </script>
        <!--球队-->
        <script type="text/template" id="team">
            <div class="team">
                <div class="header">
                    <div class="title">
                        <span>选择球队</span>
                        <div class="line"></div>
                    </div>
                </div>
                <div class="content">
                    <!-- [{"groupname":"A组","name":"法国","teamid":1},{"groupname":"A组","name":"罗马尼亚","teamid":2},{"groupname":"A组","name":"阿尔巴尼亚","teamid":3},{"groupname":"A组","name":"瑞士","teamid":4},
                    {"groupname":"B组","name":"英格兰","teamid":5},{"groupname":"B组","name":"俄罗斯","teamid":6},{"groupname":"B组","name":"威尔士","teamid":7},{"groupname":"B组","name":"斯洛伐克","teamid":8},
                    {"groupname":"C组","name":"德国","teamid":9},{"groupname":"C组","name":"乌克兰","teamid":10},{"groupname":"C组","name":"波兰","teamid":11},{"groupname":"C组","name":"北爱尔兰","teamid":12},
                    {"groupname":"D组","name":"西班牙","teamid":13},{"groupname":"D组","name":"捷克","teamid":14},{"groupname":"D组","name":"土耳其","teamid":15},{"groupname":"D组","name":"克罗地亚","teamid":16},
                    {"groupname":"E组","name":"比利时","teamid":17},{"groupname":"E组","name":"意大利","teamid":18},{"groupname":"E组","name":"爱尔兰","teamid":19},
                    {"groupname":"E组","name":"瑞典","teamid":20},{"groupname":"F组","name":"葡萄牙","teamid":21},{"groupname":"F组","name":"冰岛","teamid":22},{"groupname":"F组","name":"奥地利","teamid":23},{"groupname":"F组","name":"匈牙利","teamid":24}]}-->
                    <div class="row">
                        <a class="col" id="t24" href="#/member/24">
                            <div class="team-icon">
                                <img class="icon-xyl" />
                            </div>
                            <span>匈牙利</span>
                        </a>
                        <a class="col" id="t5" href="#/member/5">
                            <div class="team-icon">
                                <img class="icon-egl" />
                            </div>
                            <span>英格兰</span>
                        </a>
                        <a class="col" id="t2" href="#/member/2">
                            <div class="team-icon">
                                <img class="icon-lmny" />
                            </div>
                            <span>罗马尼亚</span>
                        </a>
                        <a class="col" id="t19" href="#/member/19">
                            <div class="team-icon">
                                <img class="icon-ael" />
                            </div>
                            <span>爱尔兰</span>
                        </a>
                    </div>
                    <div class="row">
                        <a class="col" id="t7" href="#/member/7">
                            <div class="team-icon">
                                <img class="icon-wes" />
                            </div>
                            <span>威尔士</span>
                        </a>
                        <a class="col" id="t15" href="#/member/15">
                            <div class="team-icon">
                                <img class="icon-teq" />
                            </div>
                            <span>土耳其</span>
                        </a>
                        <a class="col" id="t4" href="#/member/4">
                            <div class="team-icon">
                                <img class="icon-rs" />
                            </div>
                            <span>瑞士</span>
                        </a>
                        <a class="col" id="t16" href="#/member/16">
                            <div class="team-icon">
                                <img class="icon-kldy" />
                            </div>
                            <span>克罗地亚</span>
                        </a>
                    </div>
                    <div class="row">
                        <a class="col" id="t13" href="#/member/13">
                            <div class="team-icon">
                                <img class="icon-xby" />
                            </div>
                            <span>西班牙</span>
                        </a>
                        <a class="col" id="t20" href="#/member/20">
                            <div class="team-icon">
                                <img class="icon-rd" />
                            </div>
                            <span>瑞典</span>
                        </a>
                        <a class="col" id="t22" href="#/member/22">
                            <div class="team-icon">
                                <img class="icon-bd" />
                            </div>
                            <span>冰岛</span>
                        </a>
                        <a class="col" id="t17" href="#/member/17">
                            <div class="team-icon">
                                <img class="icon-bls" />
                            </div>
                            <span>比利时</span>
                        </a>
                    </div>
                    <div class="row">
                        <a class="col" id="t6" href="#/member/6">
                            <div class="team-icon">
                                <img class="icon-els" />
                            </div>
                            <span>俄罗斯</span>
                        </a>
                        <a class="col" id="t1" href="#/member/1">
                            <div class="team-icon">

                                <img class="icon-fg" />
                            </div>
                            <span>法国</span>
                        </a>
                        <a class="col" id="t23" href="#/member/23">
                            <div class="team-icon">

                                <img class="icon-adl" />
                            </div>
                            <span>奥地利</span>
                        </a>
                        <a class="col" id="t10" href="#/member/10">
                            <div class="team-icon">
                                <img class="icon-wkl" />
                            </div>
                            <span>乌克兰</span>
                        </a>
                    </div>
                    <div class="row">
                        <a class="col" id="t18" href="#/member/18">
                            <div class="team-icon">
                                <img class="icon-ydl" />
                            </div>
                            <span>意大利</span>
                        </a>
                        <a class="col" id="t8" href="#/member/8">
                            <div class="team-icon">
                                <img class="icon-slfk" />
                            </div>
                            <span>斯洛伐克</span>
                        </a>
                        <a class="col" id="t12" href="#/member/12">
                            <div class="team-icon">
                                <img class="icon-bael" />
                            </div>
                            <span>北爱尔兰</span>
                        </a>
                        <a class="col" id="t3" href="#/member/3">
                            <div class="team-icon">
                                <img class="icon-aebny" />
                            </div>
                            <span>阿尔巴尼亚</span>
                        </a>
                    </div>
                    <div class="row">
                        <a class="col" id="t14" href="#/member/14">
                            <div class="team-icon">
                                <img class="icon-jk" />
                            </div>
                            <span>捷克</span>
                        </a>
                        <a class="col" id="t11" href="#/member/11">
                            <div class="team-icon">
                                <img class="icon-bolan" />
                            </div>
                            <span>波兰</span>
                        </a>
                        <a class="col" id="t21" href="#/member/21">
                            <div class="team-icon">
                                <img class="icon-pty" />
                            </div>
                            <span>葡萄牙</span>
                        </a>
                        <a class="col" id="t9" href="#/member/9">
                            <div class="team-icon">
                                <img class="icon-dg" />
                            </div>
                            <span>德国</span>
                        </a>
                    </div>
                </div>
            </div>
        </script>
        <!-- 球员-->
        <script type="text/template" id="member">
            <div class="member ">
                <header class="hhly-header">
                    <div class="hhly-header-left" style="color:white;font-size:.51rem;">
                        <a href="#/team" ><</a>
                    </div>
                    <div class="hhly-header-center">
                        点击选择球员
                        <img src="./img/line2.png"/>
                    </div>
                    <div class="hhly-header-right">
                        <!--<img src="./img/gq.png" id="gjqz" class=""/>-->
                        <div class="icon-qels" id="guoqi"></div>
                        <span id="guojia">俄罗斯</span>
                    </div>
                </header>
                <div class="content">
                    <div class="row">
                        <div class="left">
                            门将
                        </div>
                        <div class="right" id="goalkeeper">
                            <!--<a class="item col5">-->
                            <!--<div class="mj">-->
                            <!--&lt;!&ndash;<div class="tou"></div>&ndash;&gt;-->
                            <!--<img src="./img/tou.png" class="tou"/>-->
                            <!--<img src="./img/man.png" class="shen"/>-->
                            <!--</div>-->
                            <!--<span>特尔事特根</span>-->
                            <!--</a>-->
                        </div>
                    </div>
                    <div style="clear:both"></div>
                    <div class="line"></div>
                    <div class="row">
                        <div class="left">
                            后卫
                        </div>
                        <div class="right" id="back">
                            <!--<a class="item col5">-->
                            <!--<div class="mj">-->
                            <!--<div class="tou"></div>-->
                            <!--<div class="shen"></div>-->
                            <!--</div>-->
                            <!--<span>特尔事特根</span>-->
                            <!--</a>-->
                        </div>
                    </div>
                    <div style="clear:both"></div>
                    <div class="line"></div>
                    <div class="row">
                        <div class="left">
                            中场
                        </div>
                        <div class="right" id="midfield">
                            <!--<a class="item col5">-->
                            <!--<div class="mj">-->
                            <!--<div class="tou"></div>-->
                            <!--<div class="shen"></div>-->
                            <!--</div>-->
                            <!--<span>莱诺</span>-->
                            <!--</a>-->
                        </div>
                    </div>
                    <div style="clear:both"></div>
                    <div class="line"></div>
                    <div class="row">
                        <div class="left">
                            前锋
                        </div>
                        <div class="right" id="forward">
                            <!--<a class="item col5">-->
                            <!--<div class="mj">-->
                            <!--<div class="tou"></div>-->
                            <!--<div class="shen"></div>-->
                            <!--</div>-->
                            <!--<span>莱诺</span>-->
                            <!--</a>-->
                        </div>
                    </div>
                </div>
            </div>

        </script>
        <!-- 球员模板-->
        <script type="text/template" id="team-member">
            <a class="item col5">
                <div class="<%=cls%>">
                    <img src="<%=tou%>" class="tou"/>
                    <div  class="<%=shen%>"></div>
                </div>
            </a>
        </script>
        <script type="text/template" id="team-member2">
            <a class="item col5">
                <div class="mj">
                    <img src="<%=tou%>" class="qiuyuan"/>
                </div>
            </a>
        </script>

        <!--分享-->
        <script type="text/template" id="share">
            <div class="back page" style="">
                <div class="header">
                    <div class="title">
                        <span><span id="nickname"></span>的最佳阵容</span>
                        <div class="line"></div>
                        <ul class="master hide">
                            <li class="m">你是新一代绿荫大师:穆里尼奥</li>
                            <li class="s">
                                <div>战斗力:</div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="body">
                    <!-- man -->
                    <div class="item mj" id="mj">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="item hw1" id="back1">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item  hw2" id="p2">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw3" id="p3">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw4" id="p4">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="clear" style="clear:both"></div>
                    <div class="item hw5"  id="p5">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw6"  id="p6">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw7"  id="p7">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw8"  id="p8">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="clear" style="clear:both"></div>
                    <div class="item hw9"  id="p9">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw10"  id="p10">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                </div>
                <div class="footer">
                    <div class="opt">
                        <button class="btn show" id="selectbutton">选择我的最佳阵容</button>
                    </div>
                </div>
            </div>

        </script>

        <!-- 分享后的页面-->

        <script type="text/template" id="new_share">
            <div class="back page" style="">
                <div class="panel hide">
                    <a class="exit"><img src="./img/exit.png"/></a>
                    <div class="title">玩法规则</div>
                    <p>
                        从24支球队中选出你心目中的欧洲杯最佳阵容,
                        最终与欧足协官方公布的最佳十一人
                        一只或人气最高,匹配度最高,将获得一比分
                        官方赠送的大奖礼包一份
                    </p>
                </div>
                <div class="header">
                    <div class="title">
                        <span><span id="nickname"></span>的最佳阵容</span>
                        <div class="line"></div>
                        <ul class="master hide">
                            <li class="m">你是新一代绿荫大师:穆里尼奥</li>
                            <li class="s">
                                <div>战斗力:</div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                                <div class="star"></div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="body">
                    <!-- man -->
                    <div class="item mj" id="mj">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="item hw1" id="back1">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item  hw2" id="p2">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw3" id="p3">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw4" id="p4">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="clear" style="clear:both"></div>
                    <div class="item hw5"  id="p5">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw6"  id="p6">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw7"  id="p7">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw8"  id="p8">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="clear" style="clear:both"></div>
                    <div class="item hw9"  id="p9">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw10"  id="p10">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                </div>
                <div class="footer">
                    <div class="opt">
                        <button class="btn show" id="selectbutton">选择我的最佳阵容</button>
                    </div>
                </div>
            </div>

        </script>
        <!-- 选择球员-->
        <script type="text/template" id="select">
            <div class="select  page" style="">
                <div class="panel hide">
                    <a class="exit"><img src="./img/exit.png"/></a>
                    <div class="title">玩法规则</div>
                    <p>
                        从24支球队中选出你心目中的欧洲杯最佳阵容,
                        最终与欧足协官方公布的最佳十一人
                        一只或人气最高,匹配度最高,将获得一比分
                        官方赠送的大奖礼包一份
                    </p>
                </div>
                <div class="header">
                    <div class="title">
                        <!--<span><span id="nickname"></span>的最佳阵容</span>-->
                        <!--<div class="line"></div>-->
                        <!--<ul class="master hide">-->
                            <!--<li class="m">你是新一代绿荫大师:穆里尼奥</li>-->
                            <!--<li class="s">-->
                                <!--<div>战斗力:</div>-->
                                <!--<div class="star"></div>-->
                                <!--<div class="star"></div>-->
                                <!--<div class="star"></div>-->
                                <!--<div class="star"></div>-->
                                <!--<div class="star"></div>-->
                            <!--</li>-->
                        <!--</ul>-->
                    </div>
                </div>
                <div class="body">
                    <!-- man -->
                    <div class="item mj" id="mj">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="item hw1" id="back1">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item  hw2" id="p2">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw3" id="p3">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw4" id="p4">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>

                    <div class="clear" style="clear:both"></div>
                    <div class="item hw5"  id="p5">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw6"  id="p6">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw7"  id="p7">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw8"  id="p8">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="clear" style="clear:both"></div>
                    <div class="item hw9"  id="p9">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                    <div class="item hw10"  id="p10">
                        <img src="./img/default.png" style="width:.77rem;height:1.48rem"/>
                    </div>
                </div>
                <div class="footer">
                    <div class="opt">
                        <div class="tip show">点击任意头像选择球员</div>
                        <button class="btn hide" id="sharebutton">分享我的最佳阵容到朋友圈</button>
                    </div>
                </div>
            </div>

        </script>
@import '../../template/foot.html'
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script type="text/javascript">
            var urlObj={
                "development": "http://192.168.10.242:8181",
                "production": "http://m.13322.com",
                "test":"http://m.1332255.com"
            }
            var master = [{"瓜迪奥拉":5},{"穆里尼奥":5},{"西蒙尼":4},{"弗格森":4},{"恩里克":4},{"安切洛蒂":3},{"里皮":3},{"温格":2},{"齐达内":2},{"高洪波":1}];
            var master_sum = ["中国足球靠你了","你还只是个菜鸟教练","你的战术初露锋芒","你已具备大师风范","你是新一代绿茵场大师"];
            //全局变量，保持阵容等.
            var reshare = false;   //是否是分享的页面.
            var first = true;
            var isAll = 0;
            var zhenrong = [];
            var id = new Date().getMilliseconds(); //没有获取Openid成功后的备份Id.
            $(".panel .exit").bind("click",function(e){
                $(".panel").removeClass("show").addClass("hide");
                first = false;
            });
            if(first){
                $(".panel").removeClass("hide").addClass("show");
            }
            //数据service.
            var dataService = {};
            dataService.url = {
                save: urlObj["development"]+"/mlottery/core/activity.addBestTeam.do", //http://192.168.10.242:8181
                get:urlObj["development"]+"/mlottery/core/activity.findBestTeam.do"
            }
            dataService.getData = function(activityUserId ){
                $.ajax({
                    url:dataService.url.get,
                    data:{
                        activityId : 10001,
                        activityUserId : activityUserId
                    },
                    cache: true,
                    type:"get",
                    success:function(data){
//                        zhenrong = data.data.resultData;
                        var result = JSON.parse(data.data.resultData);
                        nickName = result.nickName;
                        var list = result.data || [];
                        $("#nickname").html(nickName);
                        isAll =  renderMember(list,isAll);
                    },
                    error :function(err){
                        console.log("fail",err);
                    }
                })
            }
            dataService.saveData = function(id,data){
                $.ajax({
                    url:dataService.url.save,
                    data:{
                        activityId : 10001,
                        activityUserId : id,
                        resultData : ""+JSON.stringify(data)
                    },
                    type : "post",
                    success:function(data){
                        console.log("ok",data);
                    },
                    error :function(err){
                        console.log("fail",err);
                    }
                })
            }

            /** 微信sdk ,這裡的微信返回地址和我們的stateman地址會有衝突.**/
            var weixin = {};
            var openid = "";
            var isshare = window.location.search.indexOf("id=") >=0 ? true : false;
            var nickName = "";
            console.log(window.location);
            if (isshare){
                var openid = window.location.search.substr(window.location.search.indexOf("id=")+3,window.location.search.length-1);// hash is restore location.hash;
                console.log(openid);
                reshare = true;
                dataService.getData(openid)
            } else {

            }
            /**初始化页面传递的变量**/
            var select = [];
            var teamMap = {
                "1" : "./img/man.png",  //德国球队id : 德国队服.
                "2" : "",
            }
            var qiuyiMap = {
                "1" : "icon-q-faguo",
                "2" : "icon-q-lmny",
                "3" : "",
                "6" : "icon-q-els",
                "11" : "icon-q-bolan",
                "17" : "icon-q-bls",
                "19" : "icon-q-ael"

            }
            var gjMap = {
                        "1":["icon-qfg","法国"],
                        "2":["icon-qlmny","罗马尼亚"],
                        "3":["icon-qaebny","阿尔巴尼亚"],
                        "4":["icon-qrs","瑞士"],
                        "5":["icon-qygl","英格兰"],
                        "6":["icon-qels","俄罗斯"],
                        "7":["icon-qwes","威尔士"],
                        "8":["icon-qslfk","斯洛伐克"],
                        "9":["icon-qdg","德国"],
                        "10":["icon-qwkl","乌克兰"],
                        "11":["icon-qbolan","波兰"],
                        "12":["icon-qbael","北爱尔兰"],
                        "13":["icon-qxby","西班牙"],
                        "14":["icon-qjk","捷克"],
                        "15":["icon-qteq","土耳其"],
                        "16":["icon-qkldy","克罗地亚"],
                        "17":["icon-qbls",""],
                        "18":["icon-qydl","意大利"],
                        "19":["icon-qael","爱尔兰"],
                        "20":["icon-qrd","瑞典"],
                        "21":["icon-qpty","葡萄牙"],
                        "22":["icon-qbd","冰岛"],
                        "23":["icon-qadl","奥地利"],
                        "24":["icon-qxyl","匈牙利"]
            }
            var state = {
                "index" : {
                    enter : function(){
                        $("#app").html($("#index").html());
                    }
                },
                "select" : {
                    enter : function(){
                        $("#app").html($("#select").html());
                        var isAll = 0;   //局部变量...
                        isAll = renderMember(zhenrong,isAll);
                        console.log("是否选择完毕",isAll);
                        if (isAll === 11){
                            $(".select .tip").removeClass("show").addClass("hide");
                            $("#sharebutton").removeClass("hide").addClass("show");
                        }
                        $(".item").bind("click",function(e){
                            var position = $(this).attr("id");
                            window.localStorage.setItem("currentSelectPosition",position);
                            stateman.go("team");
                        })
                        $("#sharebutton").bind("click",function(e){
                            window.localStorage.setItem("zhenrong",JSON.stringify(zhenrong));
                            stateman.go("share");
                        })
                    }
                },
                "home" : {
                    enter : function (){
                        console.log("enter: "+this.name);
                        document.getElementById("app").innerHTML = document.getElementById("index").innerHTML;
                    },
                    leave : function(){
                        console.log("leave : " + this.name);
                    }
                },
                "team" : {
                    enter : function() {
                        document.getElementById("app").innerHTML = document.getElementById("team").innerHTML;
                    },
                    leave : function() {
                        console.log("leave : " + this.name);
                    }
                },
                "member" :{
                    url : "member/:id(\\d+)",
                    enter : function() {
                        console.log("leave : " + this.name);
                        document.getElementById("app").innerHTML = document.getElementById("member").innerHTML;
                        var team = window.localStorage.getItem("team");
                        var teamid = stateman.current.param.id;
                        console.log(teamid,gjMap[teamid]);
                        var className = $("#guoqi").attr("class");
                        $("#guoqi").removeClass(className).addClass(gjMap[teamid][0]);
                        $("#guojia").html(gjMap[teamid][1]);
                        $.getJSON(
                                urlObj["test"]+'/mlottery/core/info.findAppEuropeanPlayer.do',
                                {teamid:teamid},
                                function(result){
                                    var list = result.infos || [];
                                    var template_html = $("#team-member2").html();
                                    var team_template = _.template(template_html);
                                    var shen= "";//deprecated.......
                                    console.log(team_template);
                                    var back = "";
                                    var forward = "";
                                    var midfield = "";
                                    var goalkeeper = "";
                                    for(var i=0;i<list.length;i++){
                                        //for 后卫.
                                        var item = list[i];
                                        var position = item.positional;
                                        if(position === "后卫") {
                                            var temp = team_template({cls:"mj",name:item.name,tou:item.iMAGE,shen:shen});
                                            back+=temp;
                                        }
                                        //for 前锋.
                                        if(position === "前锋") {
                                            var temp = team_template({cls:"mj",name:item.name,tou:item.iMAGE,shen:shen});
                                            forward+=temp;
                                        }
                                        //for 门将.
                                        if(position === "门将") {
                                            var temp = team_template({cls:"mj",name:item.name,tou:item.iMAGE,shen:shen});
                                            goalkeeper+=temp;
                                        }
                                        //for 中场.
                                        if(position === "中场") {
                                            var temp = team_template({cls:"mj",name:item.name,tou:item.iMAGE,shen:shen});
                                            midfield+=temp;
                                        }
                                    }
                                    $("#back").html(back);
                                    $("#forward").html(forward);
                                    $("#goalkeeper").html(goalkeeper);
                                    $("#midfield").html(midfield);
                                    //事件...
                                    $("a.item").bind("click",function(e){
                                        console.log("a.item click",e);
                                        var tou = $(this).find("img").attr("src");
                                        var name = $(this).find("span").html();
                                        console.log("name:",name);
                                        var currentSelectPosition = window.localStorage.getItem("currentSelectPosition");
                                        zhenrong.push({"key":currentSelectPosition,"value":tou,"shen":shen,"name":name});
                                        console.log("stateman.go()");
                                        stateman.go("select");
                                    })
                                }
                        );
                    },
                    leave : function() {
                        console.log("leave : " + this.name);
                    }
                },
                "newShare" : {
                    enter : function(){
                        $("#app").html($("#new_share").html());
                        var openid = window.location.search.substr(window.location.search.indexOf("id=")+3,window.location.search.indexOf("&")-4);// hash is restore location.hash;
                        console.log(openid);
                        reshare = true;
                        dataService.getData(openid);
                        $("#selectbutton").bind("click",function(){
                            alert("ok");
                            stateman.go("select");
                        })
                    }
                },
                "share" : {
                    enter : function(){

                        document.getElementById("app").innerHTML = document.getElementById("share").innerHTML;
//                        var path = window.location.origin + window.location.pathname + window.location.hash;   // hash is state.
//                        var noHashPath = window.location.origin + window.location.pathname;
//                        var appid = "wx7819ec8fd6b8005a";//"wxe61a7a34f73a3af3";//"wx7819ec8fd6b8005a";
//                        var secret = "d4624c36b6795d1d99dcf0547af5443d";
//                        var isHaveCode = window.location.search;
//                        var code = isHaveCode !== "" ? isHaveCode.substr(isHaveCode.indexOf("code=")+5,isHaveCode.indexOf("&")-6) : "";
//                        console.log(code,isshare);
//                        var code_url = "https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+noHashPath+"&response_type=code&scope=snsapi_base&state=123#wechat_redirect";
//                        alert(code_url);
//                        console.log(code_url);
//                        if (code === "") {
//                            window.location.href = code_url;
//                        }else {
//                            var token_url =urlObj["development"]+"/mlottery/core/weixin.findWeixinUserInfo.do";
//                            $.getJSON(token_url,{code:code},function(data){
//                                console.log(data);
//                                //{"wxUserInfo":{"openid":"otNiDs8Dne-lv4psmtgBaum6ehrU","nickname":"jeff·colin·lv","sex":"1","province":"","city":"","country":"中国","headimgurl":"http://wx.qlogo.cn/mmopen/GZl0ibbzn7k7bBALwfkeQMnHuJLST5ECHJYkFSjQnm5PpJuSNCWlJ0rDb7Kev40OybicENyylpWia9OxhqxRwIxuNN3m3JStsAZ/0","privilege":[],"unionid":null,"language":"zh_CN"}}
//                                openid = data.wxUserInfo.openid || "";
//                                nickName = data.wxUserInfo.nickname || "";
//                                console.log(nickName);
//                                window.localStorage.setItem("openid",openid);
//                                window.localStorage.setItem("nickName",nickName);
//                                $("#nickname").html(nickName);
//                            })
//                        }
                        // 获取当前微信的用户名.
//                            $("#nickname").html(nickName);
                            var isAll = 0;   //局部变量...
                            zhenrong = JSON.parse(window.localStorage.getItem("zhenrong"));
                            console.log("zhenrong:",zhenrong);
                            isAll = renderMember(zhenrong,isAll);
                            console.log("是否选择完毕"+isAll,zhenrong);
                        shareSuccess();
                        wxData = {};
//                        nickName = nickName ? nickName : window.localStorage.getItem("nickName");
                        wxData.title = '我的最佳阵容';

                        var id =  genRandom(1,10000000);
                        var sign_url = window.location.origin+window.location.pathname+window.location.search;
                        wxData.url = window.location.origin + window.location.pathname +"?id="+id+ "#/newShare";
                        wxData.img_url = "./img/share.jpg";
                        wxData.desc = "我的欧洲杯最佳阵容";
                        $.getJSON(
                                urlObj["development"]+'/mlottery/core/info.findWeixinConfig.do?callback=?',
                                {url:sign_url},
                                function(jssdkConfig){
                                    console.log(jssdkConfig);
                                    wx.config({
                                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                        appId: jssdkConfig.appId || "", // 必填，公众号的唯一标识
                                        timestamp:jssdkConfig.timestamp || "" , // 必填，生成签名的时间戳
                                        nonceStr: jssdkConfig.nonceStr || "", // 必填，生成签名的随机串
                                        signature: jssdkConfig.signature || "",// 必填，签名，见附录1
                                        jsApiList: [
                                            'onMenuShareTimeline',
                                            'onMenuShareAppMessage',
                                            'onMenuShareQQ',
                                            'onMenuShareWeibo',
                                            'onMenuShareQZone'
                                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                                    });
                                    wx.ready(function(){
                                        wx.onMenuShareTimeline({
                                            title:wxData.title, // 分享标题
                                            link:wxData.url, // 分享链接
                                            imgUrl: wxData.img_url, // 分享图标
                                            success: function () {
                                                // 用户确认分享后执行的回调函数
                                                shareSuccess();
                                            },
                                            cancel: function () {
                                                // 用户取消分享后执行的回调函数
                                            }
                                        });
                                        //分享给微信朋友
                                        wx.onMenuShareAppMessage({
                                            title: wxData.title, // 分享标题
                                            desc: wxData.desc, // 分享描述
                                            link: wxData.url, // 分享链接
                                            imgUrl: wxData.img_url, // 分享图标
                                            success: function () {
                                                // 用户确认分享后执行的回调函数
                                                shareSuccess();
                                            },
                                            cancel: function () {
                                                // 用户取消分享后执行的回调函数
                                            }
                                        });
                                        //分享到QQ
                                        wx.onMenuShareQQ({
                                            title: wxData.title, // 分享标题
                                            desc: wxData.desc, // 分享描述
                                            link: wxData.url, // 分享链接
                                            imgUrl: wxData.img_url, // 分享图标
                                            success: function () {
                                                // 用户确认分享后执行的回调函数
                                                shareSuccess();
                                            },
                                            cancel: function () {
                                                // 用户取消分享后执行的回调函数
                                            }
                                        });
                                        //分享到腾讯微博
                                        wx.onMenuShareWeibo({
                                            //title: wxData.title, // 分享标题
                                            desc: wxData.title+wxData.desc+wxData.url, // 分享描述
                                            //link: wxData.url, // 分享链接
                                            //imgUrl: wxData.img_url, // 分享图标
                                            success: function () {
                                                // 用户确认分享后执行的回调函数
                                                shareSuccess();
                                            },
                                            cancel: function () {
                                                // 用户取消分享后执行的回调函数
                                            }
                                        });
                                        //分享到QQ空间
                                        wx.onMenuShareQZone({
                                            title: wxData.title, // 分享标题
                                            desc: wxData.desc, // 分享描述
                                            link: wxData.url, // 分享链接
                                            imgUrl: wxData.img_url, // 分享图标
                                            success: function () {
                                                // 用户确认分享后执行的回调函数
                                                shareSuccess();
                                            },
                                            cancel: function () {
                                                // 用户取消分享后执行的回调函数
                                            }
                                        });
                                    })
                                    wx.error(function(){
//                                        console.log("i error",openid);
                                    })
                                }
                        );  // share function end....
                    }
                }
            }
            /**
             *用户确认分享后执行的函数.
             * **/
            function shareSuccess(){
                var amount = gen6();
                var rate = genRate();
                console.log(amount,rate);
                var id = openid ? openid :(window.localStorage.getItem("openid") ? window.localStorage.getItem("openid") : genRandom(1,10000000));
                console.log("id:",id);
                var data = {"amount":amount,"rate":rate,"data":zhenrong,"nickName":nickName};
                dataService.saveData(id,data);
            }
            /**
             * @清空分享的
             **/
            function clearShare(){
                $("#mj img").attr("src","");
                $("#back1  img").attr("src","");
                $("#p2  img").attr("src","");
                $("#p3 img").attr("src","");
                $("#p4 img").attr("src","");
                $("#p5  img").attr("src","");
                $("#p6  img").attr("src","");
                $("#p7  img").attr("src","");
                $("#p8 img").attr("src","");
                $("#p9  img").attr("src","");
                $("#p10  img").attr("src","");
                $("#nickname").html("");
                $(".master").removeClass("show").addClass("hide");
                $("#selectbutton").removeClass("show").addClass("hide");
                $("#sharebutton").removeClass("show").addClass("hide");
                $(".tip").removeClass("hide").addClass("show");
                isAll = 0;
                return isAll;
            }

            /**
             * @desp 生成随机数
             * */
             function genRandom(min,max){
                var range = max - min;
                var random = Math.random();
                return min +　Math.round(random * range);
            }
            /**
             * 生成6000到12000的随机战斗力.
             * */
            function gen6(){
                return genRandom(1,5);
            }
            // 生产随机比例.
            function genRate(){
                return genRandom(1,99);
            }
            /**
             * 根据数组循环的item渲染最佳阵容的头像.
             * @param list
             */
            function renderMember(list,isAll){
                for(var i = 0;i<list.length;i++){
                    var item  = list[i];
                    var key = item.key;
                    var tou = item.value;
                    var shen = item.shen || "./img/man.png";
                    var names = item.name || "";
                    console.log(item,key);
                    if (key ==="mj") {
                        $("#mj img").attr("src",tou);
                        isAll++;
                    }
                    if (key === "back1") {
                        $("#back1  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p2") {
                        $("#p2  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p3") {
                        $("#p3 img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p4") {
                        $("#p4 img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p5") {
                        $("#p5  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p6") {
                        $("#p6  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p7") {
                        $("#p7  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p8") {
                        $("#p8 img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p9") {
                        $("#p9  img").attr("src",tou);
                        isAll++;
                    }
                    if( key === "p10") {
                        $("#p10  img").attr("src",tou);
                        isAll++;
                    }
                }
                return isAll;
            }

            /**
             * 异步渲染
             */
            function asynRenderMember(list){
                renderMember(list);
            }
            console.log(state);

            var stateman = new StateMan();
            stateman
                    .state(state)
                    .on("notfound", function(){
                         this.go('share');
                    })
                    .start({});
        </script>
</body>
</html>